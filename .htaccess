# TinyFileManager hardening under Drupal:
# - Allow directory entrypoints (DirectoryIndex index.php)
# - Block direct access to arbitrary .php files
# - Allow only the canonical entrypoint tinyfilemanager.php

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Map per-site asset URLs to the shared assets directory (no symlinks).
  RewriteRule ^sites/[^/]+/assets/(.*)$ assets/$1 [L]

  # Block direct HTTP requests for any .php under this subtree...
  RewriteCond %{THE_REQUEST} \s/+.*\.php(?:[\s?]|$) [NC]
  # ...except the single allowed entrypoint.
  RewriteCond %{REQUEST_URI} !^/[^/]+/tools/tinyfilemanager/tinyfilemanager\.php$ [NC]
  RewriteCond %{REQUEST_URI} !^/[^/]+/tools/tinyfilemanager/sites/[^/]+/index\.php$ [NC]
  RewriteRule ^ - [F]
</IfModule>

DirectoryIndex index.php